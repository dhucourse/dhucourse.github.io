import{_ as X,r,c as A,o as Y,i as Z,a as u,b as d,d as e,e as V,w as S,f as ee,m as N,g,n as R,F as U,s as D,t as v,z as te,A as F,E as $,h as L,x as I}from"./index-CnmwwGkb.js";import{b as se,g as H}from"./course-BPG2nUBP.js";import{c as oe}from"./comment-C4UYBfxe.js";const le={class:"page-container"},ne={class:"post-content"},ae={class:"back-button"},ie={class:"post-form"},re={class:"form-section"},ue={class:"course-select"},de={key:0,class:"search-results"},ce=["onClick"],ve={class:"course-name"},me={class:"course-info"},pe={key:0,class:"selected-course"},fe={class:"course-card"},ge={class:"course-main"},_e={class:"course-name"},ke={class:"course-detail"},Ce={class:"form-section"},be={class:"form-group"},he={key:0,class:"form-group"},xe={class:"form-group"},we={class:"form-section"},ye={class:"rating-grid"},Ve={class:"rating-item"},Se={class:"rating-stars"},Re=["onClick"],Ue={class:"rating-desc"},De={class:"rating-item"},Le={class:"rating-stars"},Me=["onClick"],Be={class:"rating-desc"},Ee={class:"rating-item"},Ne={class:"rating-stars"},$e=["onClick"],Ie={class:"rating-desc"},qe={class:"form-section"},ze={class:"content-group"},Ae={class:"word-count"},Fe={class:"form-section"},He={class:"recommend-options"},Te={class:"recommend-option"},Qe={class:"recommend-option"},je={__name:"index",setup(Ge){const _=r(""),M=r(!1),n=r(null),x=Z(),T=()=>{x.push("/")},k=r([]),b=r(""),h=r(""),l=r({content:0,workload:0,exam:0}),q={content:["","内容很差","内容一般","内容尚可","内容不错","内容极好"],workload:["","很轻松","较轻松","适中","较繁重","非常繁重"],exam:["","很简单","较简单","适中","较难","很难"]},C=r(""),m=r(1);function Q(){M.value=_.value.length>0}const j=A(()=>_.value?k.value.filter(o=>{const t=_.value.toLowerCase(),i=(o.cname||"").toLowerCase(),s=(o.teacher||"").toLowerCase(),c=(o.code||"").toLowerCase();return i.includes(t)||s.includes(t)||c.includes(t)}):[]);function G(o){n.value=o,_.value="",M.value=!1}function J(){n.value=null}function B(o,t){l.value&&(l.value[o]=t)}function E(o){const t=l.value[o]||0;return q[o]&&q[o][t]||""}const K=A(()=>n.value&&b.value&&h.value!==""&&l.value.content>0&&l.value.workload>0&&l.value.exam>0&&C.value.length>=30&&m.value!==null);function O(){return n.value?b.value?h.value===""?"请输入课程成绩":l.value.content===0?"请为课程内容评分":l.value.workload===0?"请为作业量评分":l.value.exam===0?"请为考核难度评分":C.value.length<30?"评价内容不少于30字":m.value===null?"请选择推荐程度":"请完善所有评价内容":"请选择学期":"请选择课程"}const P=async()=>{if(!K.value){$.error(O());return}const o={cid:n.value.id,teacher:n.value.teacher,semester:b.value,score:h.value,contentrating:l.value.content,workloadrating:l.value.workload,examrating:l.value.exam,content:C.value,isrecommend:m.value};try{let t=await oe(o);$.success("发布成功"),x.push("/detail")}catch{$.error("错误请重试")}};return Y(async()=>{var t,i,s,c,z;let o=((i=(t=x.currentRoute.value)==null?void 0:t.query)==null?void 0:i.cid)||((c=(s=x.currentRoute.value)==null?void 0:s.params)==null?void 0:c.cid);if(o){let p=se(o);try{const a=await p,w=((z=a==null?void 0:a.data)==null?void 0:z.code)||(a==null?void 0:a.code)||(a==null?void 0:a.data);if(w){let y=k.value.find(f=>String(f.code)===String(w));if(!y)try{const f=await H();k.value=f&&(f.data||f)||[],y=k.value.find(W=>String(W.code)===String(w))}catch(f){console.error("加载课程列表以匹配课程编码失败",f)}y?n.value=y:console.warn("未找到与返回编码匹配的课程：",w)}}catch(a){console.error("获取课程编码失败",a)}}try{const p=await H();k.value=p&&(p.data||p)||[]}catch(p){console.error("加载课程列表失败",p),k.value=[]}}),(o,t)=>{const i=ee("router-link");return d(),u("div",le,[e("nav",null,[e("div",{class:"logo",style:{position:"absolute",left:"20px",cursor:"pointer"},onClick:T}," 课程测评@DHU "),e("div",null,[V(i,{to:"/detail"},{default:S(()=>[...t[7]||(t[7]=[L("课程列表",-1)])]),_:1}),V(i,{to:"/post"},{default:S(()=>[...t[8]||(t[8]=[L("发布测评",-1)])]),_:1}),V(i,{to:"/about"},{default:S(()=>[...t[9]||(t[9]=[L("关于",-1)])]),_:1})])]),e("div",ne,[e("div",ae,[V(i,{to:"/detail",class:"back-link"},{default:S(()=>[...t[10]||(t[10]=[e("span",{class:"back-icon"},"←",-1),L(" 返回课程列表 ",-1)])]),_:1})]),t[26]||(t[26]=e("div",{class:"post-header"},[e("h1",null,"发布课程测评"),e("p",{class:"subtitle"},"分享你的选课经验，帮助其他同学做出更好的选择")],-1)),e("div",ie,[e("div",re,[t[12]||(t[12]=e("h2",null,"选择课程",-1)),e("div",ue,[g(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),placeholder:"搜索课程名称",class:"search-input",onInput:Q},null,544),[[R,_.value]]),M.value?(d(),u("div",de,[(d(!0),u(U,null,D(j.value,s=>(d(),u("div",{key:s.id,class:"search-item",onClick:c=>G(s)},[e("div",ve,v(s.cname),1),e("div",me,"课程编码 | "+v(s.code),1)],8,ce))),128))])):N("",!0)]),n.value?(d(),u("div",pe,[t[11]||(t[11]=e("h3",null,"已选课程",-1)),e("div",fe,[e("div",ge,[e("div",_e,v(n.value.cname),1),e("div",ke,[e("span",null,"课程编码: "+v(n.value.code),1)])]),e("button",{class:"change-btn",onClick:J},"更换课程")])])):N("",!0)]),e("div",Ce,[t[17]||(t[17]=e("h2",null,"基本信息",-1)),e("div",be,[t[14]||(t[14]=e("label",null,"选课学期",-1)),g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),class:"select-input"},[...t[13]||(t[13]=[e("option",{value:""},"请选择学期",-1),e("option",{value:"2024-2025学年秋季学期"},"2024-2025学年秋季学期",-1),e("option",{value:"2024-2025学年春季学期"},"2024-2025学年春季学期",-1)])],512),[[te,b.value]])]),n.value?(d(),u("div",he,[t[15]||(t[15]=e("label",null,"上课老师",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>n.value.teacher=s),class:"select-input",placeholder:"输入授课老师姓名"},null,512),[[R,n.value.teacher]])])):N("",!0),e("div",xe,[t[16]||(t[16]=e("label",null,"课程成绩",-1)),g(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),class:"number-input",min:"0",max:"100",placeholder:"输入0-100的分数"},null,512),[[R,h.value]])])]),e("div",we,[t[21]||(t[21]=e("h2",null,"课程评价",-1)),e("div",ye,[e("div",Ve,[t[18]||(t[18]=e("div",{class:"rating-label"},"课程内容",-1)),e("div",Se,[(d(),u(U,null,D(5,s=>e("span",{key:s,class:I(["star",{filled:s<=l.value.content}]),onClick:c=>B("content",s)}," ★ ",10,Re)),64))]),e("div",Ue,v(E("content")),1)]),e("div",De,[t[19]||(t[19]=e("div",{class:"rating-label"},"作业量",-1)),e("div",Le,[(d(),u(U,null,D(5,s=>e("span",{key:s,class:I(["star",{filled:s<=l.value.workload}]),onClick:c=>B("workload",s)}," ★ ",10,Me)),64))]),e("div",Be,v(E("workload")),1)]),e("div",Ee,[t[20]||(t[20]=e("div",{class:"rating-label"},"考核难度",-1)),e("div",Ne,[(d(),u(U,null,D(5,s=>e("span",{key:s,class:I(["star",{filled:s<=l.value.exam}]),onClick:c=>B("exam",s)}," ★ ",10,$e)),64))]),e("div",Ie,v(E("exam")),1)])])]),e("div",qe,[t[22]||(t[22]=e("h2",null,"评价内容",-1)),e("div",ze,[g(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.value=s),class:"content-input",placeholder:"分享你对这门课的体验和建议...",rows:"8"},null,512),[[R,C.value]]),e("div",Ae,v(C.value.length)+"/2000",1)])]),e("div",Fe,[t[25]||(t[25]=e("h2",null,"推荐程度",-1)),e("div",He,[e("label",Te,[g(e("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=s=>m.value=s),value:1,name:"recommend"},null,512),[[F,m.value]]),t[23]||(t[23]=e("span",{class:"option-text recommend"},"推荐",-1))]),e("label",Qe,[g(e("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=s=>m.value=s),value:0,name:"recommend"},null,512),[[F,m.value]]),t[24]||(t[24]=e("span",{class:"option-text not-recommend"},"不推荐",-1))])])]),e("div",{class:"form-actions"},[e("button",{class:"submit-btn",onClick:P},"发布测评")])])])])}}},Pe=X(je,[["__scopeId","data-v-1fc6d4a6"]]);export{Pe as default};
